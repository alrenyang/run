<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†”ë¼ëŸ¬ë‹í¬ë£¨ - ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Home Specific Compact Stats */
        .compact-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-card-wide {
            grid-column: span 2;
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 1.25rem;
            text-align: center;
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
        }

        .stat-card-small {
            background: white;
            padding: 1.25rem 1rem;
            border-radius: 1.25rem;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .stat-card-wide .label { font-size: 0.9rem; font-weight: 600; opacity: 0.9; margin-bottom: 0.5rem; display: block; }
        .stat-card-wide .value { font-size: 2.5rem; font-weight: 900; }
        
        .stat-card-small .label { font-size: 0.8rem; font-weight: 700; color: var(--text-muted); margin-bottom: 0.25rem; display: block; }
        .stat-card-small .value { font-size: 1.5rem; font-weight: 800; color: var(--text-main); }

        @media (max-width: 480px) {
            .stat-card-wide .value { font-size: 2.2rem; }
            .stat-card-small .value { font-size: 1.25rem; }
        }
    </style>
</head>
<body>
    <aside>
        <div class="sidebar-header">
            <a href="index.html">ì†”ë¼ëŸ¬ë‹í¬ë£¨</a>
        </div>
        <nav>
            <a href="index.html" class="nav-item active">
                <span class="nav-icon">ğŸ </span>
                <span>í™ˆ</span>
            </a>
            <a href="history.html" class="nav-item">
                <span class="nav-icon">ğŸ“Š</span>
                <span>íšŒì› ê¸°ë¡</span>
            </a>
            <a href="records.html" class="nav-item">
                <span class="nav-icon">ğŸ“‹</span>
                <span>ê¸°ë¡ ë“±ë¡</span>
            </a>
            <a href="members.html" class="nav-item">
                <span class="nav-icon">ğŸ‘¤</span>
                <span>íšŒì› ê´€ë¦¬</span>
            </a>
        </nav>
    </aside>

    <main>
        <header>
            <h1>ì†”ë¼ëŸ¬ë‹í¬ë£¨</h1>
            <div id="current-date-text" style="color: var(--text-muted); font-size: 0.875rem;">ë‚ ì§œ ë¡œë”© ì¤‘...</div>
        </header>

        <!-- Crew Total Distance (Main Card) -->
        <div class="stat-card-wide">
            <span class="label">ğŸƒ í¬ë£¨ ì´ ëŸ¬ë‹ê±°ë¦¬</span>
            <div class="value"><span id="crew-total-distance">0.0</span> <span style="font-size: 1.2rem; font-weight: 600;">km</span></div>
        </div>

        <div style="margin-top: 1rem;" class="compact-stats-grid">
            <!-- Total Members -->
            <div class="stat-card-small">
                <span class="label">ğŸ‘¥ ì´ íšŒì›ìˆ˜</span>
                <div class="value" id="total-members-count">-- ëª…</div>
            </div>
            <!-- Today's Records -->
            <div class="stat-card-small">
                <span class="label">ğŸ“… ì˜¤ëŠ˜ ê¸°ë¡</span>
                <div class="value" id="today-records-count">-- ê±´</div>
            </div>
        </div>

        <div class="card" style="margin-top: 1rem; border-style: dashed; background: transparent;">
            <p style="text-align: center; color: var(--text-muted); font-size: 0.85rem; line-height: 1.5;">
                ì†”ë¼ëŸ¬ë‹í¬ë£¨ì˜ ëª¨ë“  í™œë™ ë°ì´í„°ëŠ”<br>íŒŒì´ì–´ë² ì´ìŠ¤ í´ë¼ìš°ë“œì— ì‹¤ì‹œê°„ ì €ì¥ë©ë‹ˆë‹¤.
            </p>
        </div>
    </main>

    <!-- Firebase SDK (Modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, where } 
        from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // ğŸ”¥ Firebase ì„¤ì •ê°’
        const firebaseConfig = {
            apiKey: "AIzaSyD1TE3jtcdcH6UvbfPGIy_IeaVivg2YvPA",
            authDomain: "run-app-268d5.firebaseapp.com",
            projectId: "run-app-268d5",
            storageBucket: "run-app-268d5.firebasestorage.app",
            messagingSenderId: "1064940196481",
            appId: "1:1064940196481:web:0408fd1fb557c4b2a2b380"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // í˜„ì¬ ë‚ ì§œ ì„¤ì •
        const now = new Date();
        const todayStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        document.getElementById('current-date-text').innerText = `${now.getFullYear()}ë…„ ${now.getMonth() + 1}ì›” ${now.getDate()}ì¼`;

        // 1. ì´ íšŒì›ìˆ˜ ë° í¬ë£¨ ì´ ê±°ë¦¬ ì‹¤ì‹œê°„ ê³„ì‚°
        onSnapshot(collection(db, "members"), (snapshot) => {
            document.getElementById('total-members-count').innerText = `${snapshot.size} ëª…`;
            
            let totalKm = 0;
            snapshot.forEach((doc) => {
                const data = doc.data();
                totalKm += (data.distance || 0);
            });
            document.getElementById('crew-total-distance').innerText = totalKm.toLocaleString(undefined, {minimumFractionDigits: 1, maximumFractionDigits: 1});
        });

        // 2. ì˜¤ëŠ˜ì˜ ê¸°ë¡ ì‹¤ì‹œê°„ ì¹´ìš´íŠ¸
        const activityQuery = query(collection(db, "activity_logs"), where("date", "==", todayStr));
        onSnapshot(activityQuery, (snapshot) => {
            document.getElementById('today-records-count').innerText = `${snapshot.size} ê±´`;
        });
    </script>
</body>
</html>
